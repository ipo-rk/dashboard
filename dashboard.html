<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Dashboard - Manajemen Produk</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            background: #f0f2f5;
            color: #333;
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-logo {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 12px 15px;
            display: block;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .sidebar-menu a::before {
            content: '‚ñ∏ ';
            margin-right: 8px;
        }

        .main-content {
            margin-left: 250px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .breadcrumb {
            font-size: 12px;
            color: #999;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 20px;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }

        .user-badge {
            background: #f0f2f5;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .role-badge {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .btn-logout {
            padding: 8px 16px;
            background: #ff6b6b;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-card.blue {
            border-left-color: #667eea;
        }

        .stat-card.green {
            border-left-color: #4CAF50;
        }

        .stat-card.orange {
            border-left-color: #ff9800;
        }

        .stat-card.red {
            border-left-color: #ff6b6b;
        }

        .stat-label {
            color: #999;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            color: #4CAF50;
        }

        .stat-change.negative {
            color: #ff6b6b;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .search-bar {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-bar input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .user-info {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .user-info-details {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .info-item {
            flex: 1;
            min-width: 200px;
        }

        .info-label {
            color: #999;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }

        .admin-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .admin-section.show {
            display: block;
        }

        .btn-add {
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .btn-add:hover {
            background: #5568d3;
        }

        .add-form {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            display: none;
            margin-top: 15px;
        }

        .add-form.show {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-actions {
            display: flex;
            gap: 10px;
        }

        .form-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-save {
            background: #4CAF50;
            color: white;
        }

        .btn-save:hover {
            background: #45a049;
        }

        .btn-cancel {
            background: #9e9e9e;
            color: white;
        }

        .btn-cancel:hover {
            background: #757575;
        }

        .msg {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 4px;
            display: none;
        }

        .msg.show {
            display: block;
        }

        .msg.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .msg.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .product-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .product-body {
            padding: 15px;
        }

        .product-body h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .product-price {
            color: #667eea;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .product-desc {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            max-height: 60px;
            overflow: hidden;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .product-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
        }

        .btn-edit {
            background: #2196F3;
            color: white;
        }

        .btn-edit:hover {
            background: #1976D2;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #d32f2f;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #999;
            grid-column: 1 / -1;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f0f0f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .pagination {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .pagination button,
        .pagination span {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .pagination button:hover,
        .pagination button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination span {
            cursor: default;
            border: none;
            background: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .search-bar {
                flex-direction: column;
            }

            .search-bar input {
                width: 100%;
            }

            .user-info-details {
                flex-direction: column;
                gap: 15px;
            }

            .products {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>

<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-logo">üìä Dashboard</div>
        <ul class="sidebar-menu">
            <li><a href="dashboard.html" class="active">üíº Produk</a></li>
            <li><a href="index.html">üìà Overview</a></li>
            <li><a href="products.html">üì¶ Manager</a></li>
            <li><a href="customers.html">üë• Pelanggan</a></li>
            <li><a href="messages.html">üí¨ Pesan</a></li>
            <li><a href="analytics.html">üìä Analytics</a></li>
            <li><a href="settings.html">‚öôÔ∏è Pengaturan</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div>
                    <h2 id="pageTitle" style="margin: 0; color: #333;">Manajemen Produk</h2>
                    <div class="breadcrumb">
                        <a href="index.html">Dashboard</a> / <span id="breadcrumb">Produk</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="notification-bell">
                    üîî
                    <div class="notification-badge" id="notificationBadge">0</div>
                </div>
                <div class="user-badge">
                    <span>üë§</span>
                    <div>
                        <div id="userName" style="font-weight: 600; font-size: 13px;">User</div>
                        <div id="userRole" style="font-size: 11px; color: #999;">user</div>
                    </div>
                    <span class="role-badge" id="roleBadge">USER</span>
                </div>
                <button class="btn-logout" id="logoutBtn" onclick="handleLogout()">Logout</button>
            </div>
        </div>

        <!-- Container -->
        <div class="container">
            <!-- Stats Grid -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card blue">
                    <div class="stat-label">Total Produk</div>
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-change">+5 bulan ini</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-label">Total Nilai</div>
                    <div class="stat-value" id="totalValue">Rp 0</div>
                    <div class="stat-change positive">+12% minggu ini</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-label">Produk Aktif</div>
                    <div class="stat-value" id="activeProducts">0</div>
                    <div class="stat-change">dari total</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-label">Stok Rendah</div>
                    <div class="stat-value" id="lowStockProducts">0</div>
                    <div class="stat-change negative">perlu restock</div>
                </div>
            </div>

            <!-- User Info -->
            <div class="user-info">
                <div class="user-info-details">
                    <div class="info-item">
                        <div class="info-label">Nama</div>
                        <div class="info-value" id="userFullName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Email</div>
                        <div class="info-value" id="userEmail">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Role</div>
                        <div class="info-value">
                            <span id="userRoleDisplay">User</span>
                            <span class="role-badge" id="roleBadgeDisplay">USER</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Status</div>
                        <div class="info-value" style="color: #4CAF50;">üü¢ Aktif</div>
                    </div>
                </div>
            </div>

            <!-- Message -->
            <div id="addMsg" class="msg"></div>

            <!-- Admin Section -->
            <div class="admin-section" id="adminSection">
                <button class="btn-add" onclick="toggleAddForm()">+ Tambah Produk Baru</button>
                <div class="add-form" id="addForm">
                    <h4 style="margin-top: 0; color: #333;">Form Tambah Produk</h4>
                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="productName">Nama Produk *</label>
                            <input type="text" id="productName" placeholder="Contoh: Kopi Robusta Premium" required />
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Harga (Rp) *</label>
                            <input type="number" id="productPrice" placeholder="50000" step="1000" required />
                        </div>
                        <div class="form-group">
                            <label for="productStock">Stok</label>
                            <input type="number" id="productStock" placeholder="100" min="0" value="0" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="productDesc">Deskripsi *</label>
                            <textarea id="productDesc" placeholder="Jelaskan detail produk" rows="3"
                                required></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productCategory">Kategori</label>
                            <input type="text" id="productCategory" placeholder="Contoh: Kopi, Teh, dll" />
                        </div>
                        <div class="form-group">
                            <label for="productImage">Gambar Produk (File)</label>
                            <input type="file" id="productImage" accept="image/*" />
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-save" onclick="handleAddProduct()">üíæ Simpan Produk</button>
                        <button type="button" class="btn-cancel" onclick="toggleAddForm()">Batal</button>
                    </div>
                </div>
            </div>

            <!-- Filter & Search -->
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="üîç Cari nama atau deskripsi produk..." />
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all"
                        onclick="applyFilter(this, 'all')">Semua</button>
                    <button class="filter-btn" data-filter="active" onclick="applyFilter(this, 'active')">Aktif</button>
                    <button class="filter-btn" data-filter="lowstock" onclick="applyFilter(this, 'lowstock')">Stok
                        Rendah</button>
                </div>
            </div>

            <!-- Products List -->
            <div id="productList" class="products">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Memuat produk...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display: none;"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Edit Produk</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="editName">Nama Produk *</label>
                    <input type="text" id="editName" required />
                </div>
                <div class="form-group">
                    <label for="editPrice">Harga (Rp) *</label>
                    <input type="number" id="editPrice" step="1000" required />
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="editDesc">Deskripsi *</label>
                    <textarea id="editDesc" rows="3" required></textarea>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="editCategory">Kategori</label>
                    <input type="text" id="editCategory" />
                </div>
                <div class="form-group">
                    <label for="editStock">Stok</label>
                    <input type="number" id="editStock" min="0" />
                </div>
            </div>
            <div class="form-row">
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="editImage">Gambar Produk (File)</label>
                    <input type="file" id="editImage" accept="image/*" />
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-save" onclick="handleSaveEdit()">üíæ Perbarui</button>
                <button type="button" class="btn-cancel" onclick="closeEditModal()">Batal</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let products = [];
        let currentEditId = null;
        let currentUser = null;
        let currentPage = 1;
        const itemsPerPage = 9;
        let currentFilterType = 'all';

        window.addEventListener('load', async () => {
            if (!isAuthenticated()) {
                location.href = 'login.html';
                return;
            }
            currentUser = JSON.parse(localStorage.getItem('auth_user'));
            updateUserUI();
            await loadProducts();
            setupEventListeners();
            if (currentUser.role === 'admin') {
                document.getElementById('adminSection').classList.add('show');
            }
        });

        function isAuthenticated() {
            return !!localStorage.getItem('auth_token');
        }

        function getAuthToken() {
            return localStorage.getItem('auth_token');
        }

        function updateUserUI() {
            document.getElementById('userName').textContent = currentUser.name || 'User';
            document.getElementById('userFullName').textContent = currentUser.name || '-';
            document.getElementById('userEmail').textContent = currentUser.email || '-';
            const roleBadgeText = currentUser.role === 'admin' ? 'ADMIN' : 'USER';
            document.getElementById('roleBadge').textContent = roleBadgeText;
            document.getElementById('roleBadgeDisplay').textContent = roleBadgeText;
            document.getElementById('userRoleDisplay').textContent = (currentUser.role || 'user').toUpperCase();
            document.getElementById('userRole').textContent = roleBadgeText;
        }

        async function loadProducts() {
            try {
                const res = await fetch(`${API_BASE}/products`);
                if (!res.ok) throw new Error('Gagal memuat produk');
                products = await res.json();
                updateStats();
                renderProducts(products);
            } catch (err) {
                showMessage('Error: ' + err.message, 'error');
                document.getElementById('productList').innerHTML = '<div class="empty">Gagal memuat produk</div>';
            }
        }

        function updateStats() {
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, p) => sum + (parseFloat(p.price) || 0), 0);
            const activeProducts = products.length;
            const lowStockProducts = products.filter(p => (p.stock || 0) < 10).length;

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalValue').textContent = 'Rp ' + totalValue.toLocaleString('id-ID');
            document.getElementById('activeProducts').textContent = activeProducts;
            document.getElementById('lowStockProducts').textContent = lowStockProducts;
            document.getElementById('notificationBadge').textContent = lowStockProducts > 0 ? lowStockProducts : '0';
        }

        function renderProducts(list) {
            let filteredList = list;
            if (currentFilterType === 'lowstock') {
                filteredList = list.filter(p => (p.stock || 0) < 10);
            }

            const container = document.getElementById('productList');
            if (filteredList.length === 0) {
                container.innerHTML = '<div class="empty" style="grid-column: 1/-1;">üì¶ Tidak ada produk ditemukan</div>';
                document.getElementById('pagination').style.display = 'none';
                return;
            }

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginated = filteredList.slice(start, end);

            container.innerHTML = paginated.map(p => `
                <div class="product-card">
                    <div class="product-img">${p.image ? `<img src="${p.image}" alt="${p.name}">` : '‚òï'}</div>
                    <div class="product-body">
                        <h3>${p.name}</h3>
                        <div class="product-price">Rp ${parseFloat(p.price || 0).toLocaleString('id-ID')}</div>
                        <div class="product-desc">${p.description || 'Tidak ada deskripsi'}</div>
                        <div style="font-size: 12px; color: #999; margin-bottom: 8px;">
                            ${p.category ? `<strong>Kategori:</strong> ${p.category}<br>` : ''}
                            <strong>Stok:</strong> ${p.stock || 0}
                        </div>
                        <div class="product-actions">
                            ${currentUser.role === 'admin' ? `
                                <button class="btn-edit" onclick="openEditModal('${p.id}')">‚úèÔ∏è Edit</button>
                                <button class="btn-delete" onclick="handleDelete('${p.id}')">üóëÔ∏è Hapus</button>
                            ` : `
                                <span style="color: #999; font-size: 13px; padding: 8px;">üëÅÔ∏è Tampilan saja</span>
                            `}
                        </div>
                    </div>
                </div>
            `).join('');

            renderPagination(filteredList.length);
        }

        function renderPagination(total) {
            const paginationDiv = document.getElementById('pagination');
            const pages = Math.ceil(total / itemsPerPage);
            if (pages <= 1) {
                paginationDiv.style.display = 'none';
                return;
            }
            paginationDiv.style.display = 'flex';
            let html = '';
            if (currentPage > 1) {
                html += `<button onclick="goToPage(${currentPage - 1})">‚Üê  Sebelumnya</button>`;
            }
            for (let i = 1; i <= pages; i++) {
                html += `<button class="${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }
            if (currentPage < pages) {
                html += `<button onclick="goToPage(${currentPage + 1})">Selanjutnya  ‚Üí</button>`;
            }
            paginationDiv.innerHTML = html;
        }

        function goToPage(page) {
            currentPage = page;
            renderProducts(products);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p =>
                p.name.toLowerCase().includes(query) ||
                (p.description || '').toLowerCase().includes(query)
            );
            currentPage = 1;
            currentFilterType = 'all';
            renderProducts(filtered);
        }

        function applyFilter(btn, filterType) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilterType = filterType;
            currentPage = 1;
            renderProducts(products);
        }

        function toggleAddForm() {
            document.getElementById('addForm').classList.toggle('show');
        }

        function openEditModal(id) {
            currentEditId = id;
            const product = products.find(p => p.id === id);
            if (!product) return;
            document.getElementById('editName').value = product.name;
            document.getElementById('editPrice').value = product.price;
            document.getElementById('editDesc').value = product.description || '';
            document.getElementById('editCategory').value = product.category || '';
            document.getElementById('editStock').value = product.stock || 0;
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditId = null;
        }

        async function handleAddProduct() {
            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value;
            const desc = document.getElementById('productDesc').value;
            const category = document.getElementById('productCategory').value;
            const stock = document.getElementById('productStock').value;
            const image = document.getElementById('productImage').files[0];

            if (!name || name.length < 2) {
                showMessage('Nama minimal 2 karakter', 'error');
                return;
            }
            if (!price || parseFloat(price) <= 0) {
                showMessage('Harga harus > 0', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('name', name);
                formData.append('price', price);
                formData.append('description', desc);
                formData.append('category', category);
                formData.append('stock', stock);
                if (image) formData.append('image', image);

                const res = await fetch(`${API_BASE}/products`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` },
                    body: formData
                });
                if (!res.ok) throw new Error('Gagal membuat produk');

                showMessage('Produk berhasil ditambahkan', 'success');
                document.getElementById('productForm').reset();
                document.getElementById('addForm').classList.remove('show');
                document.getElementById('productName').value = '';
                document.getElementById('productPrice').value = '';
                document.getElementById('productDesc').value = '';
                document.getElementById('productCategory').value = '';
                document.getElementById('productStock').value = '';
                document.getElementById('productImage').value = '';
                await loadProducts();
            } catch (err) {
                showMessage('Error: ' + err.message, 'error');
            }
        }

        async function handleSaveEdit() {
            const name = document.getElementById('editName').value.trim();
            const price = document.getElementById('editPrice').value;
            const desc = document.getElementById('editDesc').value;
            const category = document.getElementById('editCategory').value;
            const stock = document.getElementById('editStock').value;
            const image = document.getElementById('editImage').files[0];

            if (!name || name.length < 2) {
                showMessage('Nama minimal 2 karakter', 'error');
                return;
            }
            if (!price || parseFloat(price) <= 0) {
                showMessage('Harga harus > 0', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('name', name);
                formData.append('price', price);
                formData.append('description', desc);
                formData.append('category', category);
                formData.append('stock', stock);
                if (image) formData.append('image', image);

                const res = await fetch(`${API_BASE}/products/${currentEditId}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` },
                    body: formData
                });
                if (!res.ok) throw new Error('Gagal memperbarui produk');

                showMessage('Produk berhasil diperbarui', 'success');
                closeEditModal();
                await loadProducts();
            } catch (err) {
                showMessage('Error: ' + err.message, 'error');
            }
        }

        async function handleDelete(id) {
            if (!confirm('Yakin ingin menghapus produk ini?')) return;
            try {
                const res = await fetch(`${API_BASE}/products/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
                if (!res.ok) throw new Error('Gagal menghapus produk');
                showMessage('Produk berhasil dihapus', 'success');
                await loadProducts();
            } catch (err) {
                showMessage('Error: ' + err.message, 'error');
            }
        }

        function handleLogout() {
            if (confirm('Yakin ingin logout?')) {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('auth_user');
                location.href = 'login.html';
            }
        }

        function showMessage(msg, type) {
            const msgEl = document.getElementById('addMsg');
            msgEl.textContent = msg;
            msgEl.className = 'msg show ' + type;
            setTimeout(() => msgEl.classList.remove('show'), 5000);
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('editModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('editModal')) closeEditModal();
            });
        }
    </script>
</body>

</html>